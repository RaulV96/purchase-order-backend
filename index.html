<!DOCTYPE html>
<html>
<head>
    <title>Purchase Order Lookup</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        input { padding: 6px; }
        button { padding: 6px 10px; }
        table { border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; }
        th { background: #f4f4f4; }
        .warning { background-color: yellow; }
    </style>
</head>
<body>

<h2>Purchase Order Lookup</h2>

<input id="poInput" placeholder="Enter PO Number (e.g. PO-5257)">
<button onclick="searchPO()">Search</button>

<p id="status"></p>

<table id="results" style="display:none;">
    <thead>
        <tr>
            <th>SKU</th>
            <th>Name</th>
            <th>Ordered</th>
            <th>Received</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
async function searchPO() {
    const po = document.getElementById("poInput").value;
    const status = document.getElementById("status");
    const table = document.getElementById("results");
    const tbody = table.querySelector("tbody");

    status.textContent = "Searching...";
    tbody.innerHTML = "";
    table.style.display = "none";

    try {
        // Step 1: get purchase ID
        const orderRes = await fetch(
  `https://purchase-order-backend-2.onrender.com?po_number=${po}`
	);
        const orderData = await orderRes.json();

        if (!orderData.purchase_id) {
            status.textContent = "Purchase order not found.";
            return;
        }

        // Step 2: get order details
        const detailsRes = await fetch(
            `https://purchase-order-backend-2.onrender.com/order-details?purchase_id=${orderData.purchase_id}`
        );
        const items = await detailsRes.json();

        items.forEach(item => {
            const row = document.createElement("tr");

            if (item.received < item.ordered) {
                row.classList.add("warning");
            }

            row.innerHTML = `
                <td>${item.sku}</td>
                <td>${item.name}</td>
                <td>${item.ordered}</td>
                <td>${item.received}</td>
            `;

            tbody.appendChild(row);
        });

        table.style.display = "table";
        status.textContent = "";

    } catch (err) {
        status.textContent = "Error connecting to backend.";
    }
}
</script>

</body>

</html>
